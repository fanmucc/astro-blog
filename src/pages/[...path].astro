---
// src/pages/[...path].astro - åšå®¢è¯¦æƒ…é¡µé¢ï¼Œä¸“æ³¨äºå†…å®¹å±•ç¤º
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../layouts/Layout.astro";
import { buildMenuTree, getPageByPath, type PageEntry } from "../utils/menu";
import "../styles/markdown.css";

export async function getStaticPaths() {
	// è·å–æ‰€æœ‰å‘å¸ƒçš„é¡µé¢
	const pages = await getCollection(
		"pages",
		({ data }: { data: PageEntry["data"] }) => {
			return data.published && !data.draft;
		}
	);

	console.log("ç”Ÿæˆé™æ€è·¯å¾„ï¼Œæ€»é¡µé¢æ•°:", pages.length);

	const paths = [];

	for (const page of pages) {
		const pathParts = page.slug.split("/");
		console.log(`å¤„ç†é¡µé¢: ${page.slug}, è·¯å¾„åˆ†æ®µ:`, pathParts);

		if (pathParts.length === 1) {
			// å•å±‚é¡µé¢ï¼Œå¦‚ home -> /home
			const path = pathParts[0];
			paths.push({ params: { path }, props: { page } });
			console.log(`æ·»åŠ å•å±‚é¡µé¢è·¯å¾„: /${path}`);
		} else if (pathParts.length === 2 && pathParts[1] === "index") {
			// ä¸»èœå•çš„indexé¡µé¢ï¼Œå¦‚ home/index -> /home
			const path = pathParts[0];
			paths.push({ params: { path }, props: { page } });
			console.log(`æ·»åŠ ä¸»èœå•indexè·¯å¾„: /${path}`);
		} else if (pathParts.length === 2 && pathParts[1] !== "index") {
			// äºŒå±‚é¡µé¢ï¼Œå¦‚ react/start -> /react/start
			const path = `${pathParts[0]}/${pathParts[1]}`;
			paths.push({ params: { path }, props: { page } });
			console.log(`æ·»åŠ äºŒå±‚é¡µé¢è·¯å¾„: /${path}`);
		} else if (pathParts.length === 3 && pathParts[2] === "index") {
			// å­èœå•çš„indexé¡µé¢ï¼Œå¦‚ react/start/index -> /react/start
			const path = `${pathParts[0]}/${pathParts[1]}`;
			paths.push({ params: { path }, props: { page } });
			console.log(`æ·»åŠ å­èœå•indexè·¯å¾„: /${path}`);
		} else if (pathParts.length === 3 && pathParts[2] !== "index") {
			// å…·ä½“é¡µé¢ï¼Œéœ€è¦å¤„ç† pageName
			const pageName = page.data.pageName || pathParts[2];
			const path = `${pathParts[0]}/${pathParts[1]}/${pageName}`;
			paths.push({ params: { path }, props: { page } });
			console.log(
				`æ·»åŠ é¡µé¢è·¯å¾„: /${path} (åŸæ–‡ä»¶: ${page.slug}, pageName: ${page.data.pageName})`
			);
		}
	}

	console.log(
		"ç”Ÿæˆçš„æ‰€æœ‰è·¯å¾„:",
		paths.map((p) => `/${p.params.path}`)
	);
	return paths;
}

type Props = {
	page: CollectionEntry<"pages">;
};

const { page } = Astro.props;
const { Content } = await page.render();

// è·å–å½“å‰è·¯å¾„
const currentPath = `/${Astro.params.path}`;

// é€šè¿‡é…ç½®é¡¹æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºæ–‡ç« ç›®å½•ï¼Œé»˜è®¤æ˜¾ç¤º
const showMdMenu = page.data.showMdMenu !== false; // åªæœ‰æ˜ç¡®è®¾ç½®ä¸º false æ‰éšè—

// è°ƒè¯•ä¿¡æ¯å·²ç§»é™¤

// SEO æ•°æ®
const seoTitle = page.data.seoTitle || page.data.title;
const seoDescription = page.data.seoDescription || page.data.description;
---

<Layout
	title={seoTitle}
	description={seoDescription}
	currentPath={currentPath}
	showSidebar={true}
	showHeader={true}
	showBreadcrumb={false}
	theme='auto'
	pageType='article'
>
	<div class={`article-layout ${!showMdMenu ? "no-toc" : ""}`}>
		<!-- æ–‡ç« å†…å®¹ -->
		<article class='blog-article content-area'>
			<!-- <header class='article-header'> -->
			<!-- <h1 class='article-title'>{page.data.title}</h1> -->
			<!-- {
					page.data.description && (
						<p class='article-description'>{page.data.description}</p>
					)
				} -->
			<!-- <div class='article-meta'>
					<div class='meta-item'>
						<span class='meta-label'>ä½œè€…:</span>
						<span class='meta-value'>{page.data.author}</span>
					</div>
					<div class='meta-item'>
						<span class='meta-label'>åˆ›å»º:</span>
						<span class='meta-value'>
							{page.data.createdAt.toLocaleDateString("zh-CN")}
						</span>
					</div>
					{
						page.data.updatedAt && (
							<div class='meta-item'>
								<span class='meta-label'>æ›´æ–°:</span>
								<span class='meta-value'>
									{page.data.updatedAt.toLocaleDateString("zh-CN")}
								</span>
							</div>
						)
					}
					{
						page.data.readingTime && (
							<div class='meta-item'>
								<span class='meta-label'>é˜…è¯»æ—¶é—´:</span>
								<span class='meta-value'>{page.data.readingTime} åˆ†é’Ÿ</span>
							</div>
						)
					}
				</div> -->
			<!-- æ ‡ç­¾åŒºåŸŸ -->
			<!-- </header> -->
			<div class='article-content'>
				<Content />
			</div>
			{
				page.data.tags && page.data.tags.length > 0 && (
					<aside class='article-tags'>
						{/* <div class='tags-list'>
							{page.data.tags.map((tag) => (
								<span class='tag-item'>#{tag}</span>
							))}
						</div> */}
						<div class='text-right'>
							{page.data.author} å‘å¸ƒäº
							{page.data.createdAt.toLocaleDateString("zh-CN")}
						</div>
						{/* <div class='text-right'>
							{page.data.createdAt.toLocaleDateString("zh-CN")}
						</div>
						<div class='text-right'>
							{page.data.updatedAt.toLocaleDateString("zh-CN")}
						</div> */}
						{/* <div class='text-right'>{page.data.readingTime} åˆ†é’Ÿ</div> */}
					</aside>
				)
			}
		</article>

		<!-- æ–‡ç« ç›®å½• - ä»…åœ¨æ¡Œé¢ç«¯æ˜¾ç¤ºï¼Œå¯é€šè¿‡showMdMenué…ç½®æ§åˆ¶ -->
		{showMdMenu && (
			<aside class='article-toc-sidebar'>
				<nav class='article-nav sticky-toc' id='article-nav'>
					<!-- æ–‡ç« ç›®å½•å°†é€šè¿‡è„šæœ¬åŠ¨æ€ç”Ÿæˆ -->
				</nav>
			</aside>
		)}
	</div>

	<!-- æ–‡ç« ç‰¹å®šè„šæœ¬ -->
	<script define:vars={{ currentPath, showMdMenu }}>
		// æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦åº”è¯¥æ˜¾ç¤ºç›®å½•
		function checkShouldShowMdMenu() {
			// æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›®å½•ä¾§è¾¹æ å…ƒç´ 
			const tocSidebar = document.querySelector('.article-toc-sidebar');
			console.log('ğŸ¯ [TOC] æ£€æŸ¥ç›®å½•ä¾§è¾¹æ å…ƒç´ :', tocSidebar ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
			
			// å¦‚æœç›®å½•ä¾§è¾¹æ å­˜åœ¨ï¼Œè¯´æ˜æœåŠ¡ç«¯æ¸²æŸ“æ—¶è®¤ä¸ºåº”è¯¥æ˜¾ç¤ºç›®å½•
			if (tocSidebar) {
				return true;
			}
			
			// æ£€æŸ¥æ–‡ç« å¸ƒå±€æ˜¯å¦æœ‰ no-toc ç±»
			const articleLayout = document.querySelector('.article-layout');
			const hasNoTocClass = articleLayout && articleLayout.classList.contains('no-toc');
			console.log('ğŸ¯ [TOC] æ–‡ç« å¸ƒå±€ no-toc ç±»:', hasNoTocClass ? 'âœ… æœ‰' : 'âŒ æ²¡æœ‰');
			
			// å¦‚æœæ²¡æœ‰ no-toc ç±»ï¼Œè¯´æ˜åº”è¯¥æ˜¾ç¤ºç›®å½•
			return !hasNoTocClass;
		}

		// ç”Ÿæˆç›®å½•çš„å‡½æ•°
		function generateTOC() {
			console.log('ğŸ¯ [TOC] generateTOC å¼€å§‹æ‰§è¡Œ');
			console.log('ğŸ¯ [TOC] åˆå§‹ showMdMenu:', showMdMenu);
			console.log('ğŸ¯ [TOC] å½“å‰è·¯å¾„:', window.location.pathname);
			
			// åŠ¨æ€æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦åº”è¯¥æ˜¾ç¤ºç›®å½•
			const shouldShowMdMenu = checkShouldShowMdMenu();
			console.log('ğŸ¯ [TOC] åŠ¨æ€æ£€æŸ¥ shouldShowMdMenu:', shouldShowMdMenu);
			
			// å¦‚æœä¸æ˜¾ç¤ºç›®å½•ï¼Œä¸ç”Ÿæˆç›®å½•
			if (!shouldShowMdMenu) {
				console.log('ğŸ¯ [TOC] ä¸åº”è¯¥æ˜¾ç¤ºç›®å½•ï¼Œè·³è¿‡ç”Ÿæˆ');
				return;
			}
			
			const article = document.querySelector(".article-content");
			const nav = document.getElementById("article-nav");
			
			console.log('ğŸ¯ [TOC] DOM å…ƒç´ æ£€æŸ¥:');
			console.log('ğŸ¯ [TOC] article:', article ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°');
			console.log('ğŸ¯ [TOC] nav:', nav ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°');
			
			// å¢åŠ æ›´è¯¦ç»†çš„æ£€æŸ¥å’Œç­‰å¾…é€»è¾‘
			if (!article || !nav) {
				console.log('ğŸ¯ [TOC] DOM è¿˜æ²¡å‡†å¤‡å¥½ï¼Œ100ms åé‡è¯•');
				// å¦‚æœDOMè¿˜æ²¡å‡†å¤‡å¥½ï¼Œç­‰å¾…ä¸€ä¸‹å†è¯•
				setTimeout(generateTOC, 100);
				return;
			}

			// æ£€æŸ¥æ–‡ç« å†…å®¹æ˜¯å¦å·²ç»æ¸²æŸ“
			const headings = article.querySelectorAll("h1, h2, h3, h4, h5, h6");
			console.log('ğŸ¯ [TOC] æ‰¾åˆ°æ ‡é¢˜æ•°é‡:', headings.length);
			
			if (headings.length === 0) {
				console.log('ğŸ¯ [TOC] æ²¡æœ‰æ‰¾åˆ°æ ‡é¢˜ï¼Œå¯èƒ½å†…å®¹è¿˜æ²¡æ¸²æŸ“å®Œæˆï¼Œ150ms åé‡è¯•');
				// å¦‚æœæ²¡æœ‰æ ‡é¢˜ï¼Œå¯èƒ½å†…å®¹è¿˜æ²¡æ¸²æŸ“å®Œæˆï¼Œå†ç­‰ä¸€ä¸‹
				setTimeout(generateTOC, 150);
				return;
			}

			// æ‰“å°æ‰€æœ‰æ‰¾åˆ°çš„æ ‡é¢˜
			headings.forEach((heading, index) => {
				console.log(`ğŸ¯ [TOC] æ ‡é¢˜ ${index + 1}: ${heading.tagName} - "${heading.textContent}"`);
			});

			// æ¸…ç©ºç°æœ‰ç›®å½•
			nav.innerHTML =
				'<div class="toc-header">ç›®å½•</div><ul class="toc-list"></ul>';
			const tocList = nav.querySelector(".toc-list");
			console.log('ğŸ¯ [TOC] æ¸…ç©ºå¹¶é‡å»ºç›®å½•ç»“æ„');

			// è·å–æ‰€æœ‰æ ‡é¢˜å¹¶ç”Ÿæˆç›®å½•
			headings.forEach((heading, index) => {
				// ä¸ºæ¯ä¸ªæ ‡é¢˜æ·»åŠ  id
				const id = `heading-${index}`;
				heading.id = id;

				// åˆ›å»ºç›®å½•é¡¹
				const li = document.createElement("li");
				li.className = "toc-item";
				const a = document.createElement("a");
				// ä½¿ç”¨å½“å‰é¡µé¢çš„ URL ä½œä¸ºåŸºç¡€
				const currentPath = window.location.pathname;
				a.href = `${currentPath}#${id}`;
				a.className = "toc-link";
				a.textContent = heading.textContent;
				li.appendChild(a);
				tocList.appendChild(li);
				
				console.log(`ğŸ¯ [TOC] åˆ›å»ºç›®å½•é¡¹: ${heading.textContent} -> ${currentPath}#${id}`);
			});

			console.log('ğŸ¯ [TOC] ç›®å½•ç”Ÿæˆå®Œæˆï¼Œå…±ç”Ÿæˆ', headings.length, 'ä¸ªç›®å½•é¡¹');
			
			// ç›®å½•ç”Ÿæˆå®Œæˆåï¼Œè§¦å‘ä¸€æ¬¡é«˜äº®æ›´æ–°
			setTimeout(updateTOCHighlight, 50);
		}

		// ç›‘å¬ Astro çš„é¡µé¢åˆ‡æ¢äº‹ä»¶
		document.addEventListener("astro:page-load", () => {
			console.log('ğŸš€ [Event] astro:page-load äº‹ä»¶è§¦å‘');
			// å¢åŠ å»¶è¿Ÿç¡®ä¿å†…å®¹å®Œå…¨æ¸²æŸ“
			setTimeout(() => {
				console.log('ğŸš€ [Event] astro:page-load å»¶è¿Ÿ200msåæ‰§è¡ŒTOCç”Ÿæˆ');
				generateTOC();
				updateTOCHighlight();
			}, 200);
		});

		// ç›‘å¬ Astro çš„é¡µé¢å†…å®¹äº¤æ¢å®Œæˆäº‹ä»¶
		document.addEventListener("astro:after-swap", () => {
			console.log('ğŸš€ [Event] astro:after-swap äº‹ä»¶è§¦å‘');
			// é¡µé¢å†…å®¹äº¤æ¢åé‡æ–°ç”ŸæˆTOC
			setTimeout(() => {
				console.log('ğŸš€ [Event] astro:after-swap å»¶è¿Ÿ300msåæ‰§è¡ŒTOCç”Ÿæˆ');
				generateTOC();
				updateTOCHighlight();
			}, 300);
		});

		// åˆå§‹åŠ è½½æ—¶ç”Ÿæˆç›®å½•
		document.addEventListener("DOMContentLoaded", () => {
			console.log('ğŸš€ [Event] DOMContentLoaded äº‹ä»¶è§¦å‘');
			setTimeout(() => {
				console.log('ğŸš€ [Event] DOMContentLoaded å»¶è¿Ÿ100msåæ‰§è¡ŒTOCç”Ÿæˆ');
				generateTOC();
				updateTOCHighlight();
			}, 100);
		});

		// ç›‘å¬å®¢æˆ·ç«¯è·¯ç”±å®Œæˆäº‹ä»¶
		window.addEventListener("clientRouteComplete", () => {
			console.log('ğŸš€ [Event] clientRouteComplete äº‹ä»¶è§¦å‘');
			setTimeout(() => {
				console.log('ğŸš€ [Event] clientRouteComplete å»¶è¿Ÿ250msåæ‰§è¡ŒTOCç”Ÿæˆ');
				generateTOC();
				updateTOCHighlight();
			}, 250);
		});

		// ç›‘å¬é”šç‚¹æ»šåŠ¨å®Œæˆäº‹ä»¶
		window.addEventListener("anchorScrollComplete", () => {
			console.log('ğŸš€ [Event] anchorScrollComplete äº‹ä»¶è§¦å‘');
			setTimeout(updateTOCHighlight, 100);
		});

		// æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬ï¼Œç¡®ä¿é¡µé¢æ¿€æ´»æ—¶TOCæ­£ç¡®
		document.addEventListener("visibilitychange", () => {
			console.log('ğŸš€ [Event] visibilitychange äº‹ä»¶è§¦å‘, hidden:', document.hidden);
			if (!document.hidden) {
				setTimeout(() => {
					console.log('ğŸš€ [Event] visibilitychange é¡µé¢å¯è§ï¼Œå»¶è¿Ÿ100msåæ‰§è¡ŒTOCç”Ÿæˆ');
					generateTOC();
					updateTOCHighlight();
				}, 100);
			}
		});

		// ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ›´æ–°å½“å‰æ´»åŠ¨ç›®å½•é¡¹
		function updateTOCHighlight() {
			// åŠ¨æ€æ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤ºç›®å½•
			const shouldShowMdMenu = checkShouldShowMdMenu();
			// å¦‚æœä¸æ˜¾ç¤ºç›®å½•ï¼Œä¸æ›´æ–°ç›®å½•é«˜äº®
			if (!shouldShowMdMenu) return;
			
			const headings = document.querySelectorAll(
				".article-content h1, .article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6"
			);
			const tocLinks = document.querySelectorAll(".toc-link");

			if (headings.length === 0) return;

			const scrollTop =
				window.pageYOffset || document.documentElement.scrollTop;
			const headerHeight = document.querySelector("header")?.offsetHeight || 0;
			const offset = 120; // ä¸é”šç‚¹æ»šåŠ¨ä¿æŒä¸€è‡´çš„åç§»é‡

			// è®¡ç®—å½“å‰é˜…è¯»ä½ç½®ï¼ˆè€ƒè™‘headerå’Œåç§»é‡ï¼‰
			const readingPosition = scrollTop + headerHeight + offset;

			let currentHeading = null;

			// éå†æ‰€æœ‰æ ‡é¢˜ï¼Œæ‰¾åˆ°æœ€é€‚åˆçš„ä¸€ä¸ª
			for (let i = headings.length - 1; i >= 0; i--) {
				const heading = headings[i];
				const headingTop = heading.offsetTop;

				// å¦‚æœå½“å‰é˜…è¯»ä½ç½®å·²ç»ç»è¿‡è¿™ä¸ªæ ‡é¢˜ï¼Œåˆ™é€‰æ‹©å®ƒ
				if (readingPosition >= headingTop) {
					currentHeading = heading;
					break;
				}
			}

			// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ ‡é¢˜ï¼ˆé¡µé¢é¡¶éƒ¨ï¼‰ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
			if (!currentHeading && headings.length > 0) {
				currentHeading = headings[0];
			}

			// æ›´æ–°ç›®å½•é«˜äº®
			tocLinks.forEach((link) => {
				link.classList.remove("active");
				if (
					currentHeading &&
					link.getAttribute("href").endsWith(`#${currentHeading.id}`)
				) {
					link.classList.add("active");
				}
			});
		}

		// èŠ‚æµå‡½æ•°ï¼Œé¿å…æ»šåŠ¨äº‹ä»¶è¿‡äºé¢‘ç¹
		function throttle(func, wait) {
			let timeout;
			return function executedFunction(...args) {
				const later = () => {
					clearTimeout(timeout);
					func(...args);
				};
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
			};
		}

		// ç»‘å®šæ»šåŠ¨äº‹ä»¶ï¼ˆèŠ‚æµå¤„ç†ï¼‰
		document.addEventListener("scroll", throttle(updateTOCHighlight, 100));
	</script>

	<style is:global>
		/* ============== åŸºç¡€ä¸»é¢˜å˜é‡ ============== */
		:root {
			/* ä¸»é¢˜è‰²è°ƒ */
			--primary-color: rgb(var(--color-primary));
			--primary-dark: rgb(var(--color-primary-dark));
			--primary-light: rgb(var(--color-primary-light));

			/* åŸºç¡€é…è‰² */
			--body-text-color: #282c34;
			--content-write-bg-color: #fefefe;
			--border-color: #e8f4ee;
			--border-hover-color: var(--primary-color);
		}

		/* æš—è‰²æ¨¡å¼ */
		.dark {
			--body-text-color: #e2e8f0;
			--content-write-bg-color: #1e293b;
			--border-color: #475569;
		}

		/* ============== æ–‡ç« å¸ƒå±€å®¹å™¨ ============== */
		.article-layout {
			display: flex;
			gap: 2rem;
			max-width: 100%;
			margin: 0 auto;
			min-height: calc(100vh - 4rem); /* å‡å»headeré«˜åº¦ */
		}

		/* æ— ç›®å½•å¸ƒå±€ */
		.article-layout.no-toc {
			gap: 0;
		}

		/* ============== æ–‡ç« å†…å®¹åŒºåŸŸ ============== */
		.blog-article {
			flex: 1; /* è‡ªåŠ¨å æ®å‰©ä½™ç©ºé—´ */
			min-width: 0; /* é˜²æ­¢flex itemè¿‡åº¦æ‰©å±• */
			max-width: calc(100% - 320px); /* ä¸ºç›®å½•ç•™å‡ºç©ºé—´ */
			padding: 2rem 1rem;
		}

		/* æ— ç›®å½•æ—¶æ–‡ç« å†…å®¹ - å æ®å…¨å®½ */
		.article-layout.no-toc .blog-article {
			max-width: 100%;
			padding: 2rem 3rem; /* å¢åŠ å·¦å³å†…è¾¹è· */
		}

		.content-area {
			/* background-color: var(--content-write-bg-color);
			border-radius: 0.75rem;
			padding: 2.5rem;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); */
		}

		/* ============== æ–‡ç« ç›®å½•ä¾§è¾¹æ  ============== */
		.article-toc-sidebar {
			width: 300px; /* å›ºå®šå®½åº¦ */
			flex-shrink: 0; /* é˜²æ­¢å‹ç¼© */
			padding: 2rem 1rem 2rem 0;
		}

		.sticky-toc {
			position: sticky;
			top: 1rem; /* å¸é™„åœ¨é¡¶éƒ¨ä¸‹æ–¹1rem */
			max-height: calc(100vh - 2rem); /* ç›¸åº”è°ƒæ•´æœ€å¤§é«˜åº¦ */
			overflow-y: auto;
		}

		/* ============== æ–‡ç« ç›®å½•æ ·å¼ ============== */
		.article-nav {
			background-color: var(--content-write-bg-color);
			border: 1px solid var(--border-color);
			border-radius: 0.75rem;
			padding: 1.5rem;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
			transition: all 0.3s ease;
		}

		.article-nav:hover {
			box-shadow: 0 8px 24px rgba(84, 161, 43, 0.1);
			border-color: var(--primary-color);
		}

		/* ç›®å½•æ»šåŠ¨æ¡æ ·å¼ */
		.article-nav::-webkit-scrollbar {
			width: 4px;
		}

		.article-nav::-webkit-scrollbar-track {
			background: transparent;
		}

		.article-nav::-webkit-scrollbar-thumb {
			background: var(--primary-color);
			border-radius: 2px;
		}

		.article-nav::-webkit-scrollbar-thumb:hover {
			background: var(--primary-color);
		}

		.toc-header {
			font-weight: 600;
			color: var(--body-text-color);
			margin-bottom: 1rem;
			font-size: 0.875rem;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			border-bottom: 1px solid var(--border-color);
			padding-bottom: 0.5rem;
		}

		.toc-list {
			list-style: none;
			padding: 0;
			margin: 0;
		}

		.toc-item {
			margin-bottom: 0.25rem;
		}

		.toc-link {
			display: block;
			padding: 0.5rem 0.75rem;
			font-size: 0.875rem;
			color: var(--body-text-color);
			text-decoration: none;
			line-height: 1.4;
			border-radius: 0.375rem;
			transition: all 0.2s ease;
			border-left: 2px solid transparent;
		}

		.toc-link:hover {
			color: var(--primary-color);
			background-color: rgba(var(--color-primary), 0.05);
			border-left-color: var(--primary-color);
			transform: translateX(2px);
		}

		.toc-link.active {
			color: var(--primary-color);
			background-color: rgba(var(--color-primary), 0.1);
			border-left-color: var(--primary-color);
			font-weight: 500;
		}

		/* ============== æ–‡ç« å¤´éƒ¨æ ·å¼ ============== */
		.article-header {
			text-align: left;
			margin-bottom: 3rem;
			padding-bottom: 2rem;
			border-bottom: 1px solid var(--border-color);
		}

		.article-title {
			font-size: 2.5rem;
			font-weight: 700;
			color: var(--body-text-color);
			margin-bottom: 1rem;
			line-height: 1.2;
			position: relative;
			display: inline-block;
			transition: all 0.3s ease;
		}

		.article-title::after {
			content: "";
			position: absolute;
			bottom: -4px;
			left: 0;
			width: 0;
			height: 2px;
			background: var(--primary-color);
			transition: width 0.3s ease;
		}

		.article-title:hover {
			color: var(--primary-color);
			transform: translateY(-2px);
		}

		.article-title:hover::after {
			width: 100%;
		}

		.article-description {
			font-size: 1.25rem;
			color: var(--g-text-secondary);
			margin-bottom: 1.5rem;
			line-height: 1.6;
		}

		.article-meta {
			display: flex;
			flex-wrap: wrap;
			gap: 1.5rem;
			font-size: 0.875rem;
			justify-content: left;
		}

		.meta-item {
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.meta-label {
			font-weight: 500;
			color: var(--g-text-tertiary);
		}

		.meta-value {
			color: var(--g-text-tertiary);
		}

		/* ============== åŸºç¡€å®¹å™¨æ ·å¼ ============== */
		.article-content {
			font-family:
				"Inter",
				-apple-system,
				BlinkMacSystemFont,
				"Segoe UI",
				sans-serif;
		}

		/* è¯­è¨€æ ‡è¯†æ ·å¼ */
		.code-language {
			position: absolute;
			top: 12px;
			left: 12px;
			font-size: 12px;
			font-weight: 500;
			color: var(--body-text-color);
			background-color: rgba(255, 255, 255, 0.9);
			padding: 2px 6px;
			border-radius: 4px;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			z-index: 5;
		}

		.dark .code-language {
			background-color: rgba(30, 41, 59, 0.9);
			color: var(--body-text-color);
		}

		/* æ ‡ç­¾æ ·å¼ */
		.article-tags {
			margin-top: 2rem;
			padding-top: 2rem;
			border-top: 1px solid var(--border-color);
		}

		.tags-title {
			font-size: 1.125rem;
			font-weight: 600;
			color: var(--body-text-color);
			margin-bottom: 1rem;
		}

		.tags-list {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
		}

		.tag-item {
			padding: 0.25rem 0.75rem;
			font-size: 0.875rem;
			font-weight: 500;
			background-color: rgba(84, 161, 43, 0.1);
			color: var(--body-text-color);
			border-radius: 9999px;
			transition: all 0.3s ease;
		}

		.tag-item:hover {
			background-color: rgba(84, 161, 43, 0.2);
			color: var(--border-hover-color);
			transform: translateY(-1px);
		}

		/* å›¾ç‰‡è¦†ç›–å±‚ */
		.image-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0, 0, 0, 0.8);
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 100;
		}

		.overlay-content {
			position: relative;
			max-width: 90vw;
			max-height: 90vh;
		}

		.overlay-content img {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
		}

		.close-btn {
			position: absolute;
			top: -2rem;
			right: 0;
			font-size: 2rem;
			color: white;
			background: none;
			border: none;
			cursor: pointer;
		}

		/* ============== å“åº”å¼è®¾è®¡ ============== */

		/* å¹³æ¿ç«¯é€‚é… (1024pxä»¥ä¸‹) */
		@media (max-width: 1024px) {
			.article-layout {
				flex-direction: column;
				gap: 1.5rem;
			}

			.blog-article {
				max-width: 100%;
			}

			.article-toc-sidebar {
				width: 100%;
				padding: 0 1rem;
			}

			.sticky-toc {
				position: static;
				max-height: none;
			}

			.article-nav {
				margin-bottom: 2rem;
			}

			.toc-header {
				font-size: 1rem;
			}
		}

		/* ç§»åŠ¨ç«¯é€‚é… (768pxä»¥ä¸‹) */
		@media (max-width: 768px) {
			.article-layout {
				gap: 0; /* ç§»åŠ¨ç«¯ä¸éœ€è¦é—´è· */
				flex-direction: column;
			}

			.blog-article {
				padding: 1rem;
				max-width: 100%; /* å æ®å…¨å®½ */
			}

			/* æ— ç›®å½•æ—¶ç§»åŠ¨ç«¯æ ·å¼ */
			.article-layout.no-toc .blog-article {
				padding: 1rem 1.5rem;
				max-width: 100%;
			}

			/* æ–‡ç« æ ‡é¢˜åœ¨ç§»åŠ¨ç«¯é€‚é… */
			.article-title {
				font-size: 1.875rem; /* ç¨å¾®å‡å°å­—ä½“ */
				line-height: 1.3;
			}

			.article-description {
				font-size: 1.125rem;
			}

			.article-meta {
				flex-direction: column;
				gap: 0.75rem;
				align-items: flex-start;
			}

			/* ç§»åŠ¨ç«¯å®Œå…¨éšè—ç›®å½• */
			.article-toc-sidebar {
				display: none !important;
			}

			/* æ–‡ç« å¤´éƒ¨é€‚é… */
			.article-header {
				margin-bottom: 2rem;
				padding-bottom: 1.5rem;
			}

			/* ä¼˜åŒ–è§¦æ‘¸ä½“éªŒ */
			.toc-link,
			.tag-item {
				min-height: 44px; /* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */
				display: flex;
				align-items: center;
			}
		}

		/* å°å±ç§»åŠ¨ç«¯é€‚é… (480pxä»¥ä¸‹) */
		@media (max-width: 480px) {
			.article-title {
				font-size: 1.8rem;
			}

			.blog-article {
				padding: 0.75rem;
			}
		}

		/* å¤§å±å¹•ä¼˜åŒ– (1440pxä»¥ä¸Š) */
		@media (min-width: 1440px) {
			.article-layout {
				max-width: 1400px;
				gap: 3rem;
			}

			.article-toc-sidebar {
				width: 320px;
			}

			.blog-article {
				max-width: calc(100% - 340px);
				padding: 2rem 2rem 2rem 1rem;
			}

			/* æ— ç›®å½•æ—¶å¤§å±å¹•æ ·å¼ */
			.article-layout.no-toc .blog-article {
				max-width: 1200px; /* é™åˆ¶æœ€å¤§å®½åº¦ä¿æŒå¯è¯»æ€§ */
				margin: 0 auto; /* å±…ä¸­æ˜¾ç¤º */
				padding: 2rem 4rem; /* å¢åŠ å†…è¾¹è· */
			}
		}
	</style>
</Layout>
