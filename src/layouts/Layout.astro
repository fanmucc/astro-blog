---
// src/layouts/Layout.astro - ä¸»è¦é¡µé¢å¸ƒå±€ç»„ä»¶
import { ViewTransitions } from 'astro:transitions';
import Header from '../components/Header.astro';
import Sidebar from '../components/Sidebar.astro';
import { buildMenuTree } from '../utils/menu';

export interface Props {
	// åŸºç¡€é¡µé¢å±æ€§
	title: string;
	description?: string;
	image?: string;
	canonical?: string;
	noindex?: boolean;
	
	// å¸ƒå±€æ§åˆ¶
	currentPath?: string;
	showSidebar?: boolean;
	showHeader?: boolean;
	showBreadcrumb?: boolean;
	
	// ä¸»é¢˜æ§åˆ¶
	theme?: 'light' | 'dark' | 'auto';
	
	// é¡µé¢ç±»å‹
	pageType?: 'home' | 'article' | 'index' | 'search';
}

const {
	title,
	description = "åˆ†äº«æŠ€æœ¯è§è§£ã€ç”Ÿæ´»æ„Ÿæ‚Ÿå’Œå­¦ä¹ å¿ƒå¾—",
	image = "/og-image.jpg",
	canonical,
	noindex = false,
	currentPath = Astro.url.pathname,
	showSidebar = true,
	showHeader = true,
	showBreadcrumb = false,
	theme = 'auto',
	pageType = 'article'
} = Astro.props;

// è·å–å½“å‰ URL
const canonicalURL = canonical || new URL(Astro.url.pathname, Astro.site);
const socialImage = new URL(image, Astro.site);

// æ„å»ºèœå•æ ‘ï¼ˆå¦‚æœéœ€è¦sidebarï¼‰
const menuTree = showSidebar ? await buildMenuTree() : [];
---

<!doctype html>
<html lang='zh-CN' class='scroll-smooth'>
	<head>
		<meta charset='UTF-8' />
		<meta name='description' content={description} />
		<meta name='viewport' content='width=device-width, initial-scale=1.0' />
		<link rel='icon' type='image/svg+xml' href='/favicon.svg' />
		<meta name='generator' content={Astro.generator} />

		<!-- é¡µé¢æ ‡é¢˜ -->
		<title>{title} - Fanmu</title>

		<!-- è§„èŒƒé“¾æ¥ -->
		<link rel='canonical' href={canonicalURL} />

		<!-- æœç´¢å¼•æ“ä¼˜åŒ– -->
		{noindex && <meta name='robots' content='noindex, nofollow' />}

		<!-- Open Graph / Facebook -->
		<meta property='og:type' content='website' />
		<meta property='og:url' content={canonicalURL} />
		<meta property='og:title' content={`${title} - Fanmu`} />
		<meta property='og:description' content={description} />
		<meta property='og:image' content={socialImage} />
		<meta property='og:site_name' content='Fanmu - yancode.life' />
		<meta property='og:locale' content='zh_CN' />

		<!-- Twitter -->
		<meta property='twitter:card' content='summary_large_image' />
		<meta property='twitter:url' content={canonicalURL} />
		<meta property='twitter:title' content={`${title} - Fanmu`} />
		<meta property='twitter:description' content={description} />
		<meta property='twitter:image' content={socialImage} />

		<!-- é¢å¤–çš„ meta æ ‡ç­¾ -->
		<meta name='author' content='Fanmu' />
		<meta name='theme-color' content='#1e40af' />

		<!-- å­—ä½“å’Œé¢„è¿æ¥ -->
		<link rel='preconnect' href='https://fonts.googleapis.com' />
		<link rel='preconnect' href='https://fonts.gstatic.com' crossorigin />
		<link
			href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap'
			rel='stylesheet'
		/>
		<link
			href='https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap'
			rel='stylesheet'
		/>

		<!-- å¯ç”¨ View Transitions ä»¥è·å¾—å¹³æ»‘çš„é¡µé¢åˆ‡æ¢ä½“éªŒ -->
		<ViewTransitions />

		<!-- ä¸»é¢˜åˆå§‹åŒ–è„šæœ¬ -->
		<script is:inline define:vars={{ theme }}>
			(function initTheme() {
				console.log("ğŸ¨ åˆå§‹åŒ–ä¸»é¢˜ç³»ç»Ÿ...");

				const savedTheme = localStorage.getItem("theme");
				const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
				const propTheme = theme;

				let finalTheme;
				if (savedTheme) {
					finalTheme = savedTheme;
				} else if (propTheme && propTheme !== 'auto') {
					finalTheme = propTheme;
				} else if (prefersDark) {
					finalTheme = "dark";
				} else {
					finalTheme = "light";
				}

				// ç›´æ¥è®¾ç½®ï¼Œä¸ä½¿ç”¨è¿‡æ¸¡
				if (finalTheme === "dark") {
					document.documentElement.classList.add("dark");
				}

				localStorage.setItem("theme", finalTheme);
				console.log("âœ… ä¸»é¢˜åˆå§‹åŒ–å®Œæˆ:", finalTheme);
			})();
		</script>
	</head>

	<body class='min-h-screen transition-all duration-300'>
		<div class='app-layout' data-page-type={pageType}>
			<!-- é¡¶éƒ¨å¯¼èˆª -->
			{showHeader && (
				<Header 
					currentPath={currentPath} 
					showSearch={true} 
					showThemeToggle={true} 
				/>
			)}

			<!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
			<div class={`main-layout ${!showHeader ? 'no-header' : ''}`}>
				<!-- å·¦ä¾§è¾¹æ  -->
				{showSidebar && (
					<Sidebar 
						menuTree={menuTree} 
						currentPath={currentPath} 
					/>
				)}

				<!-- ä¸»å†…å®¹åŒº -->
				<main class={`main-content ${showSidebar ? '' : 'full-width'}`}>
					<div class='content-container'>
						<!-- é¢åŒ…å±‘å¯¼èˆª -->
						{showBreadcrumb && (
							<nav class='breadcrumb-nav' id='breadcrumb-nav'>
								<!-- é¢åŒ…å±‘å°†é€šè¿‡è„šæœ¬ç”Ÿæˆ -->
							</nav>
						)}

						<!-- é¡µé¢å†…å®¹ -->
						<div class='content-area'>
							<slot />
						</div>
					</div>
				</main>
			</div>
		</div>

		<!-- é¡¶éƒ¨åŠ è½½è¿›åº¦æ¡ -->
		<div class='page-loader' id='page-loader'>
			<div class='page-loader-bar' id='page-loader-bar'></div>
		</div>

		<!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
		<button
			id='back-to-top'
			class='fixed bottom-6 right-6 w-12 h-12 btn-primary rounded-full shadow-lg transition-all duration-300 transform translate-y-20 opacity-0 z-50'
			aria-label='è¿”å›é¡¶éƒ¨'
		>
			<svg class='w-6 h-6 mx-auto' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
				<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 10l7-7m0 0l7 7m-7-7v18'></path>
			</svg>
		</button>

		<!-- å…¨å±€è„šæœ¬ -->
		<script define:vars={{ menuTree, currentPath, showBreadcrumb }}>
			// åŠ¨æ€è°ƒæ•´ä¾§è¾¹æ ä½ç½®ï¼ˆé’ˆå¯¹å›ºå®šå®šä½ï¼‰
			function adjustSidebarPosition() {
				const header = document.querySelector('header');
				const sidebar = document.querySelector('.sidebar');
				const mainLayout = document.querySelector('.main-layout');
				
				if (sidebar) {
					let headerHeight = 0;
					
					if (header && header.offsetHeight > 0 && !mainLayout?.classList.contains('no-header')) {
						headerHeight = header.offsetHeight;
					}
					
					sidebar.style.top = headerHeight + 'px';
					sidebar.style.height = `calc(100vh - ${headerHeight}px)`;
					
					console.log("ğŸ”§ è°ƒæ•´å›ºå®šä¾§è¾¹æ ä½ç½®:", {
						headerHeight,
						top: headerHeight + 'px',
						height: `calc(100vh - ${headerHeight}px)`,
						hasHeader: !!header && !mainLayout?.classList.contains('no-header')
					});
				}
			}

			// å…¨å±€åŠŸèƒ½åˆå§‹åŒ–
			function initializeApp() {
			// è¿”å›é¡¶éƒ¨åŠŸèƒ½
				initBackToTop();
				
				// é¢åŒ…å±‘å¯¼èˆª
				if (showBreadcrumb) {
					generateBreadcrumb();
				}
				
				// å…¶ä»–å…¨å±€åŠŸèƒ½
				initGlobalFeatures();
			}

			// é¡µé¢é¦–æ¬¡åŠ è½½
			document.addEventListener("DOMContentLoaded", () => {
				initializeApp();
				// åŠ¨æ€è°ƒæ•´ä¾§è¾¹æ ä½ç½®
				setTimeout(() => {
					adjustSidebarPosition();
				}, 100);
			});
			
			// ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½åå†æ¬¡è°ƒæ•´
			window.addEventListener("load", () => {
				setTimeout(() => {
					adjustSidebarPosition();
				}, 200);
			});
			
			// View Transitions é¡µé¢åˆ‡æ¢åé‡æ–°åˆå§‹åŒ–
			document.addEventListener("astro:after-swap", () => {
				initializeApp();
				adjustSidebarPosition();
			});
			
			// çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´
			window.addEventListener("resize", adjustSidebarPosition);
			
			// å¼€å‘è°ƒè¯•ï¼šæ·»åŠ å…¨å±€å‡½æ•°ä¾›æ§åˆ¶å°æµ‹è¯•
			window.testSidebarFixed = function() {
				const sidebar = document.querySelector('.sidebar');
				const sidebarContent = document.querySelector('.sidebar-content');
				
				if (sidebar) {
					const computedStyle = getComputedStyle(sidebar);
					console.log("ğŸ§ª æµ‹è¯•å›ºå®šä¾§è¾¹æ çŠ¶æ€:");
					console.log("ä½ç½®:", computedStyle.position);
					console.log("top:", computedStyle.top);
					console.log("left:", computedStyle.left);
					console.log("z-index:", computedStyle.zIndex);
					console.log("é«˜åº¦:", computedStyle.height);
					
					if (sidebarContent) {
						console.log("å†…å®¹æ»šåŠ¨:", {
							scrollTop: sidebarContent.scrollTop,
							scrollHeight: sidebarContent.scrollHeight,
							clientHeight: sidebarContent.clientHeight,
							canScroll: sidebarContent.scrollHeight > sidebarContent.clientHeight
						});
					}
				} else {
					console.log("âŒ æœªæ‰¾åˆ°ä¾§è¾¹æ ");
				}
			};
			
			// é¡µé¢åŠ è½½è¿›åº¦æ¡æ§åˆ¶
			let loadingTimer;
			let loadingProgress = 0;

			function showPageLoader() {
				const loader = document.getElementById("page-loader");
				const loaderBar = document.getElementById("page-loader-bar");
				
				if (loader && loaderBar) {
					// é‡ç½®è¿›åº¦
					loadingProgress = 0;
					loaderBar.style.width = "0%";
					
					// æ˜¾ç¤ºåŠ è½½æ¡
					loader.classList.add("loading");
					document.body.classList.add("page-transitioning");
					
					// æ¨¡æ‹ŸåŠ è½½è¿›åº¦
					loadingTimer = setInterval(() => {
						loadingProgress += Math.random() * 15 + 5; // æ¯æ¬¡å¢åŠ  5-20%
						
						if (loadingProgress > 90) {
							loadingProgress = 90; // åœ¨90%åœæ­¢ï¼Œç­‰å¾…å®é™…å®Œæˆ
						}
						
						loaderBar.style.width = loadingProgress + "%";
					}, 100);
				}
			}

			function hidePageLoader() {
				const loader = document.getElementById("page-loader");
				const loaderBar = document.getElementById("page-loader-bar");
				
				if (loader && loaderBar) {
					// æ¸…é™¤å®šæ—¶å™¨
					if (loadingTimer) {
						clearInterval(loadingTimer);
						loadingTimer = null;
					}
					
					// ç«‹å³å®Œæˆåˆ°100%
					loadingProgress = 100;
					loaderBar.style.width = "100%";
					
					// çŸ­æš‚å»¶è¿Ÿåéšè—
					setTimeout(() => {
						loader.classList.remove("loading");
						document.body.classList.remove("page-transitioning");
						
						// é‡ç½®è¿›åº¦æ¡
						setTimeout(() => {
							loaderBar.style.width = "0%";
						}, 200);
					}, 150);
				}
			}

			// é¡µé¢åˆ‡æ¢äº‹ä»¶ç›‘å¬ï¼ˆView Transitionsï¼‰
			document.addEventListener("astro:before-preparation", showPageLoader);
			document.addEventListener("astro:after-swap", hidePageLoader);

			// å®¢æˆ·ç«¯è·¯ç”±ç³»ç»Ÿ
			class ClientRouter {
				constructor() {
					this.isNavigating = false;
					this.setupEventListeners();
					this.saveCurrentState();
					
					// åˆå§‹åŒ–æ—¶è®¾ç½®æ­£ç¡®çš„èœå•çŠ¶æ€
					setTimeout(() => {
						this.updateSidebarMenus();
						// èœå•äº‹ä»¶ç»‘å®šå·²ç§»è‡³ Sidebar.astro ç»„ä»¶ç®¡ç†
					}, 100);
					
					// é¡µé¢åŠ è½½å®Œæˆåä¹Ÿæ›´æ–°ä¸€æ¬¡èœå•çŠ¶æ€
					if (document.readyState === 'loading') {
						document.addEventListener('DOMContentLoaded', () => {
							setTimeout(() => {
								this.updateSidebarMenus();
								// èœå•äº‹ä»¶ç»‘å®šå·²ç§»è‡³ Sidebar.astro ç»„ä»¶ç®¡ç†
							}, 50);
						});
					}
				}

				saveCurrentState() {
					// ä¿å­˜å½“å‰é¡µé¢çŠ¶æ€åˆ°å†å²è®°å½•
					history.replaceState({ 
						url: window.location.href,
						title: document.title 
					}, document.title, window.location.href);
				}

				async navigate(url, addToHistory = true) {
					if (this.isNavigating || url === window.location.href) return;
					
					this.isNavigating = true;
					console.log("ğŸš€ å¼€å§‹å®¢æˆ·ç«¯è·¯ç”±è·³è½¬:", url);
					showPageLoader();

					try {
						// è·å–æ–°é¡µé¢å†…å®¹
						const response = await fetch(url);
						if (!response.ok) throw new Error(`HTTP ${response.status}`);
						
						const html = await response.text();
						const parser = new DOMParser();
						const newDoc = parser.parseFromString(html, 'text/html');

						// æ›´æ–°é¡µé¢å†…å®¹
						await this.updatePage(newDoc, url, addToHistory);
						
						console.log("âœ… å®¢æˆ·ç«¯è·¯ç”±è·³è½¬å®Œæˆ");
					} catch (error) {
						console.error("âŒ å®¢æˆ·ç«¯è·¯ç”±å¤±è´¥ï¼Œå›é€€åˆ°æ™®é€šè·³è½¬:", error);
						// å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨æ™®é€šé¡µé¢è·³è½¬
						window.location.href = url;
						return;
					} finally {
						this.isNavigating = false;
						hidePageLoader();
					}
				}

				async updatePage(newDoc, url, addToHistory) {
					// æ·»åŠ é¡µé¢åˆ‡æ¢è¿‡æ¸¡æ•ˆæœ
					const mainContent = document.querySelector('.main-content');
					// const contentArea = document.querySelector('.content-area');
					
					// if (contentArea) {
					// 	contentArea.style.opacity = '0.7';
					// 	contentArea.style.transform = 'translateY(10px)';
					// 	contentArea.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
					// }

					// çŸ­æš‚å»¶è¿Ÿåå¼€å§‹æ›´æ–°å†…å®¹
					await new Promise(resolve => setTimeout(resolve, 150));

					// æ›´æ–° URL å’Œæ ‡é¢˜
					if (addToHistory) {
						history.pushState({ 
							url: url,
							title: newDoc.title 
						}, newDoc.title, url);
					}
					document.title = newDoc.title;

					// æ›´æ–°ä¸»è¦å†…å®¹åŒºåŸŸ
					const currentMain = document.querySelector('main.main-content');
					const newMain = newDoc.querySelector('main.main-content');
					
					if (currentMain && newMain) {
						// æ›´æ–°å†…å®¹
						currentMain.innerHTML = newMain.innerHTML;
						
						// æ›´æ–°é¡µé¢ç±»å‹æ•°æ®å±æ€§
						const currentLayout = document.querySelector('.app-layout');
						const newLayout = newDoc.querySelector('.app-layout');
						if (currentLayout && newLayout) {
							const pageType = newLayout.getAttribute('data-page-type');
							if (pageType) {
								currentLayout.setAttribute('data-page-type', pageType);
							}
						}
					}

					// æ›´æ–° meta æ ‡ç­¾å’Œå¤´éƒ¨ä¿¡æ¯
					this.updateMetaTags(newDoc);

					// é‡æ–°åˆå§‹åŒ–é¡µé¢åŠŸèƒ½
					await this.reinitializePage();

					// æ¢å¤å†…å®¹æ˜¾ç¤ºæ•ˆæœ
					const updatedContentArea = document.querySelector('.content-area');
					if (updatedContentArea) {
						updatedContentArea.style.opacity = '1';
						updatedContentArea.style.transform = 'translateY(0)';
						
						// æ¸…ç†è¿‡æ¸¡æ ·å¼
						setTimeout(() => {
							updatedContentArea.style.transition = '';
							updatedContentArea.style.transform = '';
						}, 300);
					}

					// æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
					window.scrollTo({ top: 0, behavior: 'smooth' });
				}

				updateMetaTags(newDoc) {
					// æ›´æ–°éœ€è¦çš„ meta æ ‡ç­¾
					const metaSelectors = [
						'meta[name="description"]',
						'meta[property="og:title"]',
						'meta[property="og:description"]',
						'meta[property="og:url"]',
						'meta[name="twitter:title"]',
						'meta[name="twitter:description"]'
					];

					metaSelectors.forEach(selector => {
						const currentMeta = document.querySelector(selector);
						const newMeta = newDoc.querySelector(selector);
						
						if (currentMeta && newMeta) {
							const content = newMeta.getAttribute('content');
							if (content) {
								currentMeta.setAttribute('content', content);
							}
						} else if (!currentMeta && newMeta) {
							document.head.appendChild(newMeta.cloneNode(true));
						}
					});

					// æ›´æ–° canonical URL
					const currentCanonical = document.querySelector('link[rel="canonical"]');
					const newCanonical = newDoc.querySelector('link[rel="canonical"]');
					if (currentCanonical && newCanonical) {
						currentCanonical.setAttribute('href', newCanonical.getAttribute('href'));
					}
				}

				async reinitializePage() {
					console.log("ğŸ”„ é‡æ–°åˆå§‹åŒ–é¡µé¢åŠŸèƒ½");
					
					// é‡æ–°åˆå§‹åŒ–åº”ç”¨åŠŸèƒ½
					initBackToTop();
					if (showBreadcrumb) {
						generateBreadcrumb();
					}
					initGlobalFeatures();
					
					// æ›´æ–°ä¾§è¾¹æ èœå•çŠ¶æ€
					this.updateSidebarMenus();
					
					// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè®©å…¶ä»–ç»„ä»¶çŸ¥é“é¡µé¢å·²æ›´æ–°
					window.dispatchEvent(new CustomEvent('clientRouteComplete', {
						detail: { url: window.location.href }
					}));

					// çŸ­æš‚å»¶è¿Ÿç¡®ä¿æ‰€æœ‰åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ
					await new Promise(resolve => setTimeout(resolve, 50));
				}

				updateSidebarMenus() {
					const currentPath = decodeURIComponent(window.location.pathname);
					console.log("ğŸ”„ æ›´æ–°ä¾§è¾¹æ èœå•çŠ¶æ€ï¼Œå½“å‰è·¯å¾„:", currentPath);
					console.log("ğŸ”„ åŸå§‹è·¯å¾„:", window.location.pathname);
					
					// æ›´æ–°ä¸»èœå•çŠ¶æ€
					this.updateMainMenu(currentPath);
					
					// æ›´æ–°å­èœå•çŠ¶æ€
					this.updateSubMenu(currentPath);
				}

				updateMainMenu(currentPath) {
					const mainMenuItems = document.querySelectorAll('.main-menu-item');
					let currentMainMenu = null;
					
					mainMenuItems.forEach(item => {
						const itemPath = item.getAttribute('data-path');
						const menuValue = item.getAttribute('data-menu');
						
						if (itemPath && currentPath.startsWith(itemPath)) {
							item.classList.add('active');
							currentMainMenu = {
								path: itemPath,
								value: menuValue
							};
						} else {
							item.classList.remove('active');
						}
					});
					
					return currentMainMenu;
				}

				updateSubMenu(currentPath) {
					// ä½¿ç”¨ Sidebar ç»„ä»¶çš„ç®¡ç†å™¨æ¥æ›´æ–°èœå•
					if (window.SidebarManager) {
						window.SidebarManager.updatePath(currentPath);
					}
				}

				// æ—§çš„èœå•æ¸²æŸ“å‡½æ•°å·²ç§»é™¤ï¼Œç°åœ¨ç»Ÿä¸€ä½¿ç”¨ Sidebar ç»„ä»¶

				setupEventListeners() {
					// æ‹¦æˆªé“¾æ¥ç‚¹å‡»äº‹ä»¶
					document.addEventListener('click', (e) => {
						const link = e.target.closest('a');
						if (!link || !link.href) return;

						// ä¼˜å…ˆæ£€æŸ¥é”šç‚¹é“¾æ¥
						const href = link.href;
						const currentPageUrl = window.location.href.split('#')[0];
						const linkPageUrl = href.split('#')[0];
						const hash = href.split('#')[1];

						// å¦‚æœæ˜¯åŒé¡µé¢çš„é”šç‚¹é“¾æ¥ï¼Œä¼˜å…ˆå¤„ç†å¹³æ»‘æ»šåŠ¨
						if (hash && linkPageUrl === currentPageUrl) {
								e.preventDefault();
								e.stopPropagation();
								
							const target = document.getElementById(hash);
							if (target) {
								const headerHeight = document.querySelector("header")?.offsetHeight || 0;
								const stickyTocOffset = 120; // ç»™stickyç›®å½•ç•™å‡ºç©ºé—´ï¼Œä¸ç›®å½•é«˜äº®æ£€æµ‹ä¿æŒä¸€è‡´
								const targetPosition = target.offsetTop - headerHeight - stickyTocOffset;
								
								// å¹³æ»‘æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
								window.scrollTo({ 
									top: Math.max(0, targetPosition), 
									behavior: "smooth" 
								});

								// æ›´æ–°URLä¸­çš„é”šç‚¹
								if (history.replaceState) {
									history.replaceState(null, null, href);
								}

								// æ»šåŠ¨å®Œæˆåæ›´æ–°ç›®å½•é«˜äº®
								setTimeout(() => {
									// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶é€šçŸ¥ç›®å½•æ›´æ–°
									window.dispatchEvent(new CustomEvent('anchorScrollComplete', {
										detail: { hash: hash, target: target }
									}));
								}, 800); // ç­‰å¾…å¹³æ»‘æ»šåŠ¨å®Œæˆ

								console.log("ğŸ”— é”šç‚¹é“¾æ¥å¹³æ»‘æ»šåŠ¨:", {
									hash: hash,
									targetId: target.id,
									targetOffsetTop: target.offsetTop,
									headerHeight: headerHeight,
									stickyTocOffset: stickyTocOffset,
									finalScrollPosition: targetPosition
								});
							}
							return; // æå‰è¿”å›ï¼Œä¸æ‰§è¡Œåç»­çš„å®¢æˆ·ç«¯è·¯ç”±æ£€æŸ¥
						}

						// æ£€æŸ¥æ˜¯å¦åº”è¯¥ä½¿ç”¨å®¢æˆ·ç«¯è·¯ç”±
						if (this.shouldUseClientRouting(link)) {
							e.preventDefault();
							console.log("ğŸ”— æ‹¦æˆªé“¾æ¥ç‚¹å‡»ï¼Œä½¿ç”¨å®¢æˆ·ç«¯è·¯ç”±:", link.href);
							this.navigate(link.href);
						}
					});

					// å¤„ç†æµè§ˆå™¨å‰è¿›åé€€
					window.addEventListener('popstate', (e) => {
						console.log("â¬…ï¸ æµè§ˆå™¨å‰è¿›åé€€äº‹ä»¶:", e.state);
						if (e.state && e.state.url) {
							this.navigate(e.state.url, false);
						} else {
							// å…œåº•å¤„ç†
							window.location.reload();
						}
					});

					// é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
					document.addEventListener('visibilitychange', () => {
						if (!document.hidden && this.isNavigating) {
							// é¡µé¢é‡æ–°å¯è§ä¸”æ­£åœ¨å¯¼èˆªä¸­ï¼Œç¡®ä¿éšè—åŠ è½½æ¡
							setTimeout(() => {
								if (this.isNavigating) {
									hidePageLoader();
									this.isNavigating = false;
								}
							}, 100);
						}
					});
				}

				shouldUseClientRouting(link) {
					const href = link.href;
					
					// åŸºæœ¬æ£€æŸ¥
					if (!href || href === '#') return false;
					
					// æ£€æŸ¥æ˜¯å¦ä¸ºç«™å†…é“¾æ¥
					const isInternalLink = href.startsWith(window.location.origin);
					if (!isInternalLink) return false;
					
					// æ’é™¤é”šç‚¹é“¾æ¥
					const isHashLink = href.includes('#') && 
						href.split('#')[0] === window.location.href.split('#')[0];
					if (isHashLink) return false;
					
					// æ’é™¤å¤–éƒ¨é“¾æ¥
					const isExternalLink = link.hasAttribute('target') && 
						link.getAttribute('target') === '_blank';
					if (isExternalLink) return false;
					
					// æ’é™¤ä¸‹è½½é“¾æ¥
					const hasDownload = link.hasAttribute('download');
					if (hasDownload) return false;
					
					// æ’é™¤ç‰¹æ®Šåè®®
					if (href.startsWith('mailto:') || href.startsWith('tel:')) return false;
					
					// æ’é™¤ API è·¯å¾„
					if (href.includes('/api/')) return false;
					
					console.log("âœ… é“¾æ¥ç¬¦åˆå®¢æˆ·ç«¯è·¯ç”±æ¡ä»¶:", href);
					return true;
				}
			}

			// åˆå§‹åŒ–å®¢æˆ·ç«¯è·¯ç”±ï¼ˆä»…åœ¨æ”¯æŒæ—¶ï¼‰
			let clientRouter = null;
			if (typeof window !== 'undefined' && 'history' in window && 'pushState' in history) {
				clientRouter = new ClientRouter();
				console.log("ğŸš€ å®¢æˆ·ç«¯è·¯ç”±ç³»ç»Ÿå·²å¯åŠ¨");
			} else {
				console.warn("âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒå®¢æˆ·ç«¯è·¯ç”±ï¼Œä½¿ç”¨ä¼ ç»Ÿé¡µé¢è·³è½¬");
				// å›é€€åˆ°ä¼ ç»Ÿé“¾æ¥ç›‘å¬
				setupFallbackLinkListeners();
			}

			// ä¼ ç»Ÿé“¾æ¥ç›‘å¬ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰
			function setupFallbackLinkListeners() {
				document.addEventListener("click", (e) => {
					const link = e.target.closest("a");
					if (!link || !link.href) return;

					const isInternalLink = link.href.startsWith(window.location.origin);
					const isHashLink = link.href.includes("#") && 
						link.href.split("#")[0] === window.location.href.split("#")[0];
					const isExternalLink = link.hasAttribute("target") && 
						link.getAttribute("target") === "_blank";

					if (isInternalLink && !isHashLink && !isExternalLink) {
						console.log("ä¼ ç»Ÿé¡µé¢è·³è½¬:", link.href);
						showPageLoader();
						setTimeout(hidePageLoader, 2000);
					}
				});

				window.addEventListener("popstate", () => {
					showPageLoader();
					setTimeout(hidePageLoader, 1000);
				});

				// å­èœå•åŠŸèƒ½å·²ç§»è‡³ Sidebar.astro ç»„ä»¶ç®¡ç†
			}

			// è¿”å›é¡¶éƒ¨åŠŸèƒ½
			function initBackToTop() {
				const backToTopButton = document.getElementById("back-to-top");
				if (!backToTopButton) return;

				window.addEventListener("scroll", () => {
					if (window.pageYOffset > 300) {
						backToTopButton.classList.remove("translate-y-20", "opacity-0");
						backToTopButton.classList.add("translate-y-0", "opacity-100");
				} else {
						backToTopButton.classList.add("translate-y-20", "opacity-0");
						backToTopButton.classList.remove("translate-y-0", "opacity-100");
					}
				});

				backToTopButton.addEventListener("click", () => {
					window.scrollTo({ top: 0, behavior: "smooth" });
				});
			}

			// ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆª
			function generateBreadcrumb() {
				const breadcrumbNav = document.getElementById("breadcrumb-nav");
				if (!breadcrumbNav || !currentPath || currentPath === '/') return;

				const pathParts = currentPath.split("/").filter(Boolean);
				if (pathParts.length === 0) return;

				let html = '<ol class="flex items-center space-x-2 text-sm">';
				html += '<li><a href="/" class="text-gray-500 hover:text-gray-700">é¦–é¡µ</a></li>';

				let builtPath = "";
				pathParts.forEach((part, index) => {
					builtPath += "/" + part;
					const isLast = index === pathParts.length - 1;
					const menuItem = findMenuItemByPath(menuTree, builtPath);
					const label = menuItem ? menuItem.label : decodeURIComponent(part);

					html += `
						<li class="flex items-center">
							<svg class="w-4 h-4 mx-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
							</svg>
							${isLast 
								? `<span class="text-gray-700 font-medium">${label}</span>`
								: `<a href="${builtPath}" class="text-gray-500 hover:text-gray-700">${label}</a>`
							}
						</li>
					`;
				});

				html += '</ol>';
				breadcrumbNav.innerHTML = html;
			}

			// æŸ¥æ‰¾èœå•é¡¹
			function findMenuItemByPath(menuTree, targetPath) {
				function searchMenu(items) {
					for (const item of items) {
						if (item.path === targetPath) return item;
						if (item.children?.length > 0) {
							const found = searchMenu(item.children);
							if (found) return found;
						}
					}
					return null;
				}
				return searchMenu(menuTree);
			}

			// å…¶ä»–å…¨å±€åŠŸèƒ½
			function initGlobalFeatures() {
				// å¤–éƒ¨é“¾æ¥å¤„ç†
				document.querySelectorAll('a[href^="http"]').forEach((link) => {
					if (!link.href.startsWith(window.location.origin)) {
						link.setAttribute("target", "_blank");
						link.setAttribute("rel", "noopener noreferrer");
					}
				});

				// é”šç‚¹é“¾æ¥å¤„ç†å·²ç§»è‡³å®¢æˆ·ç«¯è·¯ç”±çš„äº‹ä»¶ç›‘å¬å™¨ä¸­
				// é¿å…é‡å¤ç»‘å®šå’Œäº‹ä»¶å†²çª

				// ä¼ ç»Ÿçš„çº¯é”šç‚¹é“¾æ¥å¤„ç†ï¼ˆå…¼å®¹æ€§ï¼‰- ä¸ºæ–°æ·»åŠ çš„å…ƒç´ 
				document.querySelectorAll('a[href^="#"]:not([data-scroll-bound])').forEach((anchor) => {
					anchor.setAttribute('data-scroll-bound', 'true');
					anchor.addEventListener("click", function (e) {
						e.preventDefault();
						const target = document.querySelector(this.getAttribute("href"));
						if (target) {
							const headerHeight = document.querySelector("header")?.offsetHeight || 0;
							const targetPosition = target.offsetTop - headerHeight - 20;
							window.scrollTo({ top: targetPosition, behavior: "smooth" });
						}
					});
				});

				// å­èœå•åŠŸèƒ½å·²å®Œå…¨ç§»è‡³ Sidebar.astro ç»„ä»¶ç®¡ç†
				// æ— éœ€åœ¨æ­¤å¤„é‡å¤å¤„ç†
			}
		</script>

		<!-- èœå•æ•°æ®ä¼ é€’ç»™å®¢æˆ·ç«¯ -->
		<script type="application/json" data-menu-tree set:html={JSON.stringify(menuTree)}></script>
		
		<!-- Markdown å¢å¼ºè„šæœ¬ -->
		<script>
			// ç›´æ¥å†…è” Markdown å¢å¼ºè„šæœ¬ä»¥ç¡®ä¿æ­£ç¡®åŠ è½½
			// ä¸»é¢˜æ˜ å°„é…ç½®
			const THEME_PATTERNS = [
				{
					patterns: ['tip:', 'tips:', 'æç¤ºï¼š', 'ğŸ’¡'],
					theme: 'info',
					icon: 'ğŸ’¡',
					label: 'æç¤º'
				},
				{
					patterns: ['success:', 'ok:', 'æˆåŠŸï¼š', 'âœ…'],
					theme: 'success', 
					icon: 'âœ…',
					label: 'æˆåŠŸ'
				},
				{
					patterns: ['warning:', 'warn:', 'caution:', 'è­¦å‘Šï¼š', 'æ³¨æ„ï¼š', 'âš ï¸'],
					theme: 'warning',
					icon: 'âš ï¸', 
					label: 'è­¦å‘Š'
				},
				{
					patterns: ['error:', 'danger:', 'fail:', 'é”™è¯¯ï¼š', 'å¤±è´¥ï¼š', 'âŒ'],
					theme: 'error',
					icon: 'âŒ',
					label: 'é”™è¯¯'
				}
			];

			/**
			 * æ£€æµ‹æ–‡æœ¬æ˜¯å¦åŒ¹é…ä¸»é¢˜æ¨¡å¼
			 */
			function detectTheme(text: string) {
				const trimmedText = text.trim();
				const lowerText = trimmedText.toLowerCase();
				
				for (const themeConfig of THEME_PATTERNS) {
					for (const pattern of themeConfig.patterns) {
						const lowerPattern = pattern.toLowerCase();
						if (lowerText.startsWith(lowerPattern)) {
							// ç¡®ä¿æ¨¡å¼åé¢æ˜¯ç©ºæ ¼ã€å†’å·æˆ–æ–‡æœ¬ç»“å°¾
							const afterPattern = lowerText.slice(lowerPattern.length);
							if (afterPattern === '' || afterPattern.startsWith(' ') || afterPattern.startsWith(':')) {
								return {
									...themeConfig,
									matchedPattern: pattern,
									remainingText: trimmedText.slice(pattern.length).replace(/^[:\s]+/, '').trim()
								};
							}
						}
					}
				}
				
				return null;
			}

			/**
			 * åˆ›å»ºä¸»é¢˜åŒ–çš„ blockquote å…ƒç´ 
			 */
			function createThemedBlockquote(themeInfo: any, content: string) {
				const blockquote = document.createElement('blockquote');
				blockquote.setAttribute('data-theme', themeInfo.theme);
				
				// åˆ›å»ºæ ‡é¢˜éƒ¨åˆ†
				const title = document.createElement('strong');
				title.textContent = `${themeInfo.icon} ${themeInfo.label}ï¼š`;
				
				// åˆ›å»ºå†…å®¹æ®µè½
				const paragraph = document.createElement('p');
				paragraph.appendChild(title);
				
				// å¦‚æœæœ‰å‰©ä½™æ–‡æœ¬ï¼Œæ·»åŠ åˆ°æ®µè½ä¸­
				if (themeInfo.remainingText) {
					paragraph.appendChild(document.createTextNode(' ' + themeInfo.remainingText));
				}
				
				blockquote.appendChild(paragraph);
				
				return blockquote;
			}

			/**
			 * å¤„ç†å·²ç»æ¸²æŸ“çš„ strong å…ƒç´ 
			 */
			function processStrongElements(container: HTMLElement) {
				const strongElements = container.querySelectorAll('strong');
				const replacements: any[] = [];
				
				strongElements.forEach(strongEl => {
					const text = strongEl.textContent;
					const themeInfo = detectTheme(text || '');
					
					if (themeInfo) {
						console.log('ğŸ¯ æ‰¾åˆ°åŒ¹é…çš„ strong å…ƒç´ :', text, 'ä¸»é¢˜:', themeInfo.theme);
						
						// æ£€æŸ¥æ˜¯å¦ä¸ºç‹¬ç«‹çš„æç¤ºæ¡†ï¼ˆæ•´ä¸ªæ®µè½åªæœ‰è¿™ä¸ª strong å…ƒç´ ï¼‰
						const parent = strongEl.parentNode as HTMLElement;
						const isStandaloneAlert = (parent as HTMLElement).tagName === 'P' && 
							(parent as HTMLElement).children.length === 1 && 
							(parent as HTMLElement).textContent?.trim() === strongEl.textContent?.trim();
						
						replacements.push({
							element: strongEl,
							themeInfo: themeInfo,
							isStandalone: isStandaloneAlert
						});
					}
				});
				
				// æ‰§è¡Œæ›¿æ¢
				replacements.forEach(replacement => {
					const { element, themeInfo, isStandalone } = replacement;
					
					if (isStandalone) {
						// å¦‚æœæ˜¯ç‹¬ç«‹çš„æç¤ºæ¡†ï¼Œæ›¿æ¢æ•´ä¸ªæ®µè½ä¸º blockquote
						const blockquote = createThemedBlockquote(themeInfo, themeInfo.remainingText);
						const parent = element.parentNode;
						parent.parentNode.replaceChild(blockquote, parent);
					} else {
						// å¦‚æœæ˜¯æ··åˆå†…å®¹ï¼Œåªå°† strong å…ƒç´ è½¬æ¢ä¸ºä¸»é¢˜åŒ–çš„ span
						const themedSpan = createThemedSpan(themeInfo, themeInfo.remainingText);
						element.parentNode.replaceChild(themedSpan, element);
					}
				});
				
				return replacements.length;
			}
			
			/**
			 * åˆ›å»ºä¸»é¢˜åŒ–çš„ span å…ƒç´ ï¼ˆç”¨äºå†…è”æ˜¾ç¤ºï¼‰
			 */
			function createThemedSpan(themeInfo: any, content: string) {
				const span = document.createElement('span');
				span.setAttribute('data-theme', themeInfo.theme);
				span.className = 'inline-alert';
				
				// æ·»åŠ å›¾æ ‡å’Œå†…å®¹
				span.textContent = `${themeInfo.icon} ${themeInfo.label}${content ? ': ' + content : ''}`;
				
				return span;
			}

			/**
			 * éå†å¹¶å¤„ç†æ‰€æœ‰æ–‡æœ¬èŠ‚ç‚¹
			 */
			function processNode(node: Node) {
				if (node.nodeType === Node.TEXT_NODE) {
					// ç§»é™¤æœªå®šä¹‰çš„ processTextNode è°ƒç”¨
					// processTextNode(node);
				} else if (node.nodeType === Node.ELEMENT_NODE) {
					// é¿å…å¤„ç†å·²ç»æ˜¯ blockquote çš„å…ƒç´ 
					const element = node as Element;
					if (element.tagName !== 'BLOCKQUOTE' && element.tagName !== 'CODE' && element.tagName !== 'PRE') {
						// è½¬æ¢ä¸ºæ•°ç»„ä»¥é¿å…åœ¨éå†æ—¶ä¿®æ”¹é›†åˆ
						const childNodes = Array.from(node.childNodes);
						childNodes.forEach(child => processNode(child));
					}
				}
			}

			/**
			 * å¤„ç†é¡µé¢ä¸­çš„ Markdown å†…å®¹
			 */
			function processMarkdown() {
				console.log('ğŸ” å¼€å§‹å¤„ç† Markdown å†…å®¹...');
				
				// æŸ¥æ‰¾æ–‡ç« å†…å®¹å®¹å™¨
				const articleContainer = document.querySelector('.article-content') as HTMLElement;
				
				if (articleContainer) {
					console.log('âœ… æ‰¾åˆ°æ–‡ç« å®¹å™¨:', articleContainer);
					console.log('ğŸ“ å®¹å™¨å†…å®¹é¢„è§ˆ:', articleContainer.textContent ? articleContainer.textContent.substring(0, 200) : 'æ— å†…å®¹');
					
					// å¤„ç†å·²æ¸²æŸ“çš„ strong å…ƒç´ 
					const processedCount = processStrongElements(articleContainer);
					console.log(`âœ… Markdown ä¸»é¢˜åŒ–å¤„ç†å®Œæˆï¼Œå¤„ç†äº† ${processedCount} ä¸ªå…ƒç´ `);
				} else {
					console.warn('âŒ æœªæ‰¾åˆ° .article-content å®¹å™¨');
					console.log('ğŸ” å½“å‰é¡µé¢æ‰€æœ‰å®¹å™¨:', document.querySelectorAll('[class*="content"], [class*="article"]'));
				}
			}

			/**
			 * åˆå§‹åŒ– Markdown å¢å¼ºåŠŸèƒ½
			 */
			function initMarkdownEnhancer() {
				// ç­‰å¾… DOM åŠ è½½å®Œæˆ
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', processMarkdown);
				} else {
					processMarkdown();
				}
			}

			// è‡ªåŠ¨åˆå§‹åŒ–
			initMarkdownEnhancer();

			// ç›‘å¬å®¢æˆ·ç«¯è·¯ç”±å®Œæˆäº‹ä»¶ï¼Œé‡æ–°å¤„ç†æ–°é¡µé¢å†…å®¹
			window.addEventListener('clientRouteComplete', () => {
				setTimeout(processMarkdown, 100);
			});
		</script>
	</body>
</html>

<style is:global>
	/* å¯¼å…¥å…¨å±€æ ·å¼ */
	@import "../styles/global.css";

	/* åº”ç”¨å¸ƒå±€ */
	.app-layout {
		min-height: 100vh;
		background-color: var(--g-bg);
		display: flex;
		flex-direction: column;
	}

	/* ä¸»å¸ƒå±€ */
	.main-layout {
		display: block; /* æ”¹ä¸ºblockå¸ƒå±€ï¼Œå› ä¸ºä¾§è¾¹æ ç°åœ¨æ˜¯fixed */
		flex: 1;
		height: calc(100vh - 4rem);
	}

	.main-layout.no-header {
		height: 100vh;
	}

	/* ä¸»å†…å®¹åŒº */
	.main-content {
		margin-left: 16rem; /* ä¸ºå›ºå®šä¾§è¾¹æ ç•™å‡ºç©ºé—´ */
		overflow: visible; /* æ”¹ä¸ºvisibleä»¥æ”¯æŒstickyå®šä½ */
		background-color: var(--m-content-bg);
		height: 100%;
		/* Firefox æ»šåŠ¨æ¡æ ·å¼ */
		scrollbar-width: thin;
		scrollbar-color: var(--g-border) transparent;
		/* å¹³æ»‘æ»šåŠ¨ */
		scroll-behavior: smooth;
		/* åœ¨ iOS ä¸Šå¯ç”¨æƒ¯æ€§æ»šåŠ¨ */
		-webkit-overflow-scrolling: touch;
	}

	.main-content.full-width {
		margin-left: 0; /* æ— ä¾§è¾¹æ æ—¶å–æ¶ˆå·¦è¾¹è· */
		width: 100%;
	}

	/* ä¸»å†…å®¹åŒºæ»šåŠ¨æ¡æ ·å¼ */
	.main-content::-webkit-scrollbar {
		width: 6px;
	}

	.main-content::-webkit-scrollbar-track {
		background: transparent;
	}

	.main-content::-webkit-scrollbar-thumb {
		background: var(--g-border);
		border-radius: 3px;
		transition: background-color var(--transition-normal);
	}

	.main-content::-webkit-scrollbar-thumb:hover {
		background: rgba(var(--color-primary), 0.6);
	}

	.content-container {
		padding: 1.5rem 2rem;
		max-width: none;
	}

	.content-area {
		max-width: none;
	}

	/* é¢åŒ…å±‘å¯¼èˆª */
	.breadcrumb-nav {
		margin-bottom: 1.5rem;
		padding-bottom: 1rem;
		border-bottom: 1px solid var(--b-crumb-border);
	}

	/* è¿”å›é¡¶éƒ¨æŒ‰é’® */
	#back-to-top {
		background: var(--btn-primary-bg);
		color: var(--btn-primary-text);
	}

	#back-to-top:hover {
		background: var(--btn-primary-bg-hover);
		transform: translateY(-1px) scale(1.05);
	}

	/* ç§»åŠ¨ç«¯é€‚é… */
	@media (max-width: 768px) {
		.content-container {
			padding: 1rem;
		}

		/* ç§»åŠ¨ç«¯ä¸»å†…å®¹åŒºåŸŸ - å æ®å…¨å®½ */
		.main-content {
			margin-left: 0 !important; /* ç§»åŠ¨ç«¯ä¸é¢„ç•™ä¾§è¾¹æ ç©ºé—´ */
			width: 100%;
		}

		.main-content.full-width {
			margin-left: 0;
		}

		/* ç§»åŠ¨ç«¯ä¼˜åŒ–æ»šåŠ¨æ¡ */
		.main-content::-webkit-scrollbar {
			width: 2px;
		}

		/* ç§»åŠ¨ç«¯èœå•æ¿€æ´»æ—¶ç¦æ­¢ä¸»å†…å®¹æ»šåŠ¨ */
		body.mobile-menu-active .main-content {
			overflow: hidden;
		}
	}

	@media (min-width: 1280px) {
		.content-container {
			padding: 2rem 3rem;
		}

		/* å¤§å±å¹•ä¸»å†…å®¹åŒºåŸŸé€‚é… */
		.main-content {
			margin-left: 18rem; /* é€‚é…å¤§å±å¹•ä¾§è¾¹æ å®½åº¦ */
		}

		.main-content.full-width {
			margin-left: 0;
		}
	}

	/* é¡µé¢ç±»å‹ç‰¹å®šæ ·å¼ */
	.app-layout[data-page-type="home"] {
		/* é¦–é¡µç‰¹å®šæ ·å¼ */
	}

	.app-layout[data-page-type="article"] {
		/* æ–‡ç« é¡µé¢ç‰¹å®šæ ·å¼ */
	}

	/* View Transitions é…ç½® - ç¦ç”¨æ‰€æœ‰åŠ¨ç”»ï¼Œä½¿ç”¨é¡¶éƒ¨åŠ è½½æ¡ */
	@view-transition {
		navigation: auto;
	}

	/* å®Œå…¨ç¦ç”¨æ‰€æœ‰ View Transitions åŠ¨ç”» */
	::view-transition-old(root),
	::view-transition-new(root) {
		animation: none;
	}

	/* é¡¶éƒ¨åŠ è½½è¿›åº¦æ¡ */
	.page-loader {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		height: 3px;
		z-index: 9999;
		pointer-events: none;
		opacity: 0;
		transition: opacity var(--transition-fast) ease-in-out;
	}

	.page-loader.loading {
		opacity: 1;
	}

	.page-loader-bar {
		height: 100%;
		background: linear-gradient(
			90deg,
			rgb(var(--color-primary)) 0%,
			rgba(251, 146, 60, 0.8) 50%,
			rgb(var(--color-primary)) 100%
		);
		border-radius: 0 2px 2px 0;
		position: relative;
		overflow: hidden;
		width: 0%;
		transition: width var(--transition-normal) var(--theme-transition-easing);
	}

	.page-loader-bar::after {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: linear-gradient(
			90deg,
			transparent 0%,
			rgba(255, 255, 255, 0.4) 50%,
			transparent 100%
		);
		animation: shimmer 1.5s infinite;
	}

	@keyframes shimmer {
		0% {
			transform: translateX(-100%);
		}
		100% {
			transform: translateX(100%);
		}
	}

	/* é¡µé¢åˆ‡æ¢æ—¶çš„åé¦ˆ */
	.page-transitioning {
		cursor: wait;
	}

	.page-transitioning .main-content {
		pointer-events: none;
	}
	
	/* å®¢æˆ·ç«¯è·¯ç”±é¡µé¢åˆ‡æ¢æ•ˆæœ */
	.content-area {
		transition: opacity var(--transition-fast) ease, transform var(--transition-fast) ease;
	}
	
	.content-area.transitioning {
		opacity: 0.7;
		transform: translateY(10px);
	}
	
	/* ä¼˜åŒ–é“¾æ¥ç‚¹å‡»åé¦ˆ */
	a {
		transition: opacity var(--transition-fast) ease;
	}
	
	a:active {
		opacity: 0.7;
	}
	
	/* å®¢æˆ·ç«¯è·¯ç”±ä¸“ç”¨åŠ è½½çŠ¶æ€ */
	.client-routing-active {
		position: relative;
	}
	
	.client-routing-active::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(255, 255, 255, 0.1);
		pointer-events: none;
		opacity: 0;
		transition: opacity var(--transition-fast) ease;
	}
	
	.client-routing-active.loading::before {
		opacity: 1;
	}

	/* ä¸»èœå•å­—ä½“æ ·å¼è°ƒæ•´ */
	.main-menu-item {
		font-size: 0.8125rem !important;
		font-weight: 500 !important;
	}

	.main-menu-text {
		font-size: inherit;
	}

	/* å­èœå•æ ·å¼å·²å®Œå…¨ç§»è‡³ Sidebar.astro ç»„ä»¶ç»Ÿä¸€ç®¡ç† */
	/* é¿å…æ ·å¼å†²çªï¼Œæ­¤å¤„ä¸å†å®šä¹‰ submenu ç›¸å…³æ ·å¼ */
</style>

